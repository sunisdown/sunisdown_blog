<!doctype html>
<html lang="zh" itemscope itemtype="http://schema.org/Person">
<head>
  <meta charset="utf-8">
  <!-- Site Meta Data -->
  <title>Python 装饰器之 functools.wraps</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="">
  <meta name="author" content="sunisdown">

  <link rel="shortcut icon" href="">

  <!-- schema.org -->
  <meta itemprop="name" content="SunisDown">
  <meta itemprop="image" content="">
  <meta itemprop="description" content="">

  <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,600,700' rel='stylesheet' type='text/css'>
  <!-- Style Meta Data -->
  <link rel="stylesheet" href="http://www.sunisdown.me/theme/css/style.css" type="text/css" />
  <link rel="stylesheet" href="http://www.sunisdown.me/theme/css/pygments.css" type="text/css" />

  <!-- Feed Meta Data -->
    <link href="http://www.sunisdown.me/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="SunisDown ATOM Feed" />

  <!-- Twitter Feed -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="">
  <meta name="twitter:image" content="">

<meta name="twitter:creator" content="">
<meta name="twitter:url" content="http://www.sunisdown.me/python-zhuang-shi-qi-zhi-functoolswraps.html">
<meta name="twitter:title" content="SunisDown ~ Python 装饰器之 functools.wraps">
<meta name="twitter:description" content="<p>在看 Bottle 代码中看见 functools.wraps 这种用法。</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">make_default_app_wrapper</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Return a callable that relays calls to the current default app. &quot;&quot;&quot;</span>
    <span class="n">a</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">Bottle</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
    <span class="nd">@functools.wraps</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">Bottle</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">ka</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">app</span><span class="p">(),</span> <span class="n">name</span><span class="p">)(</span><span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">ka</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">wrapper</span>
</pre></div>
<p>之前没有看过，于是查文档了解了一下他的用处 先下定义： <strong>functools.wraps
是 ``装饰器``的``装饰器 ...</strong></p>">

<!-- Facebook Meta Data -->
<meta property="og:title" content="SunisDown ~ Python 装饰器之 functools.wraps" />
<meta property="og:description" content="<p>在看 Bottle 代码中看见 functools.wraps 这种用法。</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">make_default_app_wrapper</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Return a callable that relays calls to the current default app. &quot;&quot;&quot;</span>
    <span class="n">a</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">Bottle</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
    <span class="nd">@functools.wraps</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">Bottle</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">ka</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">app</span><span class="p">(),</span> <span class="n">name</span><span class="p">)(</span><span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">ka</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">wrapper</span>
</pre></div>
<p>之前没有看过，于是查文档了解了一下他的用处 先下定义： <strong>functools.wraps
是 ``装饰器``的``装饰器 ...</strong></p>" />
<meta property="og:image" content="" />
</head>

<body>
  <!-- Sidebar -->
  <aside>
    <!--<center><a href="http://www.sunisdown.me"><img id="avatar" src=""></a></center>-->
    <h1>SunisDown</h1>
    <br>


    <nav class="nav">
      <ul class="list-bare">
      
          <li><a class="nav__link" href="/index.html">Blog</a></li>
          <li><a class="nav__link" href="/archives.html">Archives</a></li>
          <li><a class="nav__link" href="/tags.html">Tags</a></li>
         
          <li><a class="nav__link" href="http://www.sunisdown.me/pages/about.html">About</a></li>
         
      </ul>
    </nav>

    <p class="social">
        <a href="https://github.com/sunisdown" target="_blank" ><img src="http://www.sunisdown.me/theme/images/icons/github.png"></a>
        <a href="https://twitter.com/SunisD0wn" target="_blank" ><img src="http://www.sunisdown.me/theme/images/icons/twitter.png"></a>
      <a href="http://www.sunisdown.me/feeds/all.atom.xml" rel="alternate">
        <img src="http://www.sunisdown.me/theme/images/icons/rss.png"></a>
    </p>

    <!--
    <h2>Categories</h2>
    <ul class="navbar">
      <li class="active"><a href="http://www.sunisdown.me/category/articles.html">articles</a></li>
    </ul> 
    -->
  </aside>

  <!-- Content -->
  <article>
<section id="content">
    <article>
        <h2 class="post_title post_detail"><a href="http://www.sunisdown.me/python-zhuang-shi-qi-zhi-functoolswraps.html" rel="bookmark" title="Permalink to Python 装饰器之 functools.wraps">Python 装饰器之 functools.wraps</a></h2>
        <div class="entry-content blog-post">
            <p>在看 Bottle 代码中看见 functools.wraps 这种用法。</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">make_default_app_wrapper</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Return a callable that relays calls to the current default app. &quot;&quot;&quot;</span>
    <span class="n">a</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">Bottle</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
    <span class="nd">@functools.wraps</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">Bottle</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">ka</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">app</span><span class="p">(),</span> <span class="n">name</span><span class="p">)(</span><span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">ka</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">wrapper</span>
</pre></div>
<p>之前没有看过，于是查文档了解了一下他的用处 先下定义： <strong>functools.wraps
是 ``装饰器``的``装饰器``</strong></p>
<p>要明白 functiools.wraps 首先要明白 Python 的 <tt class="docutils literal">Decorator</tt></p>
<div class="section" id="decorator">
<h2>Decorator</h2>
<p>在以前的 Blog 中曾经简单写过 Decorator。这次需要讲的更细一些。</p>
<p><tt class="docutils literal">Decorator 通过返回包装对象实现间接调用,以此插入额外逻辑。</tt>是从老大那边偷来的哪里摘抄来的，应该算是言简意赅了。</p>
<div class="highlight"><pre><span></span><span class="nd">@dec2</span>
<span class="nd">@dec1</span>
<span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">,</span> <span class="o">...</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
<p>可以还原成</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">,</span> <span class="o">...</span><span class="p">):</span>
    <span class="k">pass</span>
<span class="n">func</span> <span class="o">=</span> <span class="n">dec2</span><span class="p">(</span><span class="n">dec1</span><span class="p">(</span><span class="n">func</span><span class="p">))</span>
</pre></div>
<div class="highlight"><pre><span></span><span class="nd">@decomaker</span><span class="p">(</span><span class="n">argA</span><span class="p">,</span> <span class="n">argB</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">,</span> <span class="o">...</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
<p>可以还原成</p>
<div class="highlight"><pre><span></span><span class="n">func</span> <span class="o">=</span> <span class="n">decomaker</span><span class="p">(</span><span class="n">argA</span><span class="p">,</span> <span class="n">argB</span><span class="p">,</span> <span class="o">...</span><span class="p">)(</span><span class="n">func</span><span class="p">)</span>
</pre></div>
<div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="k">def</span> <span class="nf">outer</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
   <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="nf">inner</span><span class="p">():</span>
   <span class="o">...</span><span class="p">:</span>         <span class="k">print</span> <span class="s2">&quot;before func&quot;</span>
   <span class="o">...</span><span class="p">:</span>         <span class="n">ret</span> <span class="o">=</span> <span class="n">func</span><span class="p">()</span>
   <span class="o">...</span><span class="p">:</span>         <span class="k">return</span> <span class="n">ret</span> <span class="o">+</span> <span class="mi">1</span>
   <span class="o">...</span><span class="p">:</span>     <span class="k">return</span> <span class="n">inner</span> <span class="c1">#返回 inner 函数对象</span>
   <span class="o">...</span><span class="p">:</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="nd">@outer</span>  <span class="c1"># 解释器执⾏行 foo = outer(foo)</span>
   <span class="o">...</span><span class="p">:</span> <span class="k">def</span> <span class="nf">foo</span><span class="p">():</span>
   <span class="o">...</span><span class="p">:</span>     <span class="k">return</span> <span class="mi">1</span>
   <span class="o">...</span><span class="p">:</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">foo</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="o">&lt;</span><span class="n">function</span> <span class="n">__main__</span><span class="o">.</span><span class="n">inner</span><span class="o">&gt;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">foo</span><span class="p">()</span>
        <span class="n">before</span> <span class="n">func</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="mi">2</span>
</pre></div>
<p>这个过程中执行了下面几步</p>
<ol class="arabic simple">
<li>函数 foo 作为 装饰器 outer 的参数被传入</li>
<li>函数 inner 对 func 进行调用，然后装饰器 outer 返回 inner</li>
<li>原来的函数名 foo 关联到
inner，如上面的<tt class="docutils literal">foo &lt;function __main__.inner&gt;</tt> 所示，调用 foo
时间上是在调用 inner</li>
</ol>
<p>装饰器不仅可以用函数返回包装对象，也可以是个类，不过这种方法太尼玛啰嗦，这里就不介绍了，想了解的自己去翻吧。下面我们写一个有点用处的
Decorator。 假想我们有个coordinate类，而且这个类提供了
<tt class="docutils literal">x, y</tt>坐标，而我们要对两个coordinate 对象进行计算。代码如下：</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Coordinate</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">y</span>
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;Coord: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Coordinate</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">b</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">b</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">sub</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Coordinate</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">b</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">b</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="n">one</span> <span class="o">=</span> <span class="n">Coordinate</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="n">two</span> <span class="o">=</span> <span class="n">Coordinate</span><span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="n">three</span> <span class="o">=</span> <span class="n">Coordinate</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mi">100</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="n">sub</span><span class="p">(</span><span class="n">one</span><span class="p">,</span> <span class="n">three</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="n">Coord</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="mi">300</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="mi">200</span><span class="p">}</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="n">add</span><span class="p">(</span><span class="n">one</span><span class="p">,</span> <span class="n">three</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="n">Coord</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="n">sub</span><span class="p">(</span><span class="n">one</span><span class="p">,</span> <span class="n">two</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="n">Coord</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">200</span><span class="p">}</span>
</pre></div>
<p>上面例子中的<tt class="docutils literal">sub(one, two)</tt>与<tt class="docutils literal">three</tt>都有负数，当我们把坐标限制在第一象限时，这两个就不符合我们的要求，用
Decorator 来做一个检测再好不过了</p>
<div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
   <span class="o">....</span><span class="p">:</span>     <span class="k">def</span> <span class="nf">checker</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
   <span class="o">....</span><span class="p">:</span>         <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">a</span><span class="o">.</span><span class="n">y</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
   <span class="o">....</span><span class="p">:</span>             <span class="n">a</span> <span class="o">=</span> <span class="n">Coordinate</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">x</span> <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">y</span> <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">y</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
   <span class="o">....</span><span class="p">:</span>         <span class="k">if</span> <span class="n">b</span><span class="o">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">b</span><span class="o">.</span><span class="n">y</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
   <span class="o">....</span><span class="p">:</span>             <span class="n">b</span> <span class="o">=</span> <span class="n">Coordinate</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">x</span> <span class="k">if</span> <span class="n">b</span><span class="o">.</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">b</span><span class="o">.</span><span class="n">y</span> <span class="k">if</span> <span class="n">b</span><span class="o">.</span><span class="n">y</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
   <span class="o">....</span><span class="p">:</span>         <span class="n">ret</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
   <span class="o">....</span><span class="p">:</span>         <span class="k">if</span> <span class="n">ret</span><span class="o">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">ret</span><span class="o">.</span><span class="n">y</span> <span class="o">&lt;</span><span class="mi">0</span><span class="p">:</span>
   <span class="o">....</span><span class="p">:</span>             <span class="n">ret</span> <span class="o">=</span> <span class="n">Coordinate</span><span class="p">(</span><span class="n">ret</span><span class="o">.</span><span class="n">x</span> <span class="k">if</span> <span class="n">ret</span><span class="o">.</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ret</span><span class="o">.</span><span class="n">y</span> <span class="k">if</span> <span class="n">ret</span><span class="o">.</span><span class="n">y</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
   <span class="o">....</span><span class="p">:</span>         <span class="k">return</span> <span class="n">ret</span>
   <span class="o">....</span><span class="p">:</span>     <span class="k">return</span> <span class="n">checker</span>
   <span class="o">....</span><span class="p">:</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="nd">@wrapper</span>
   <span class="o">....</span><span class="p">:</span> <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
   <span class="o">....</span><span class="p">:</span>     <span class="k">return</span> <span class="n">Coordinate</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">b</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">b</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
   <span class="o">....</span><span class="p">:</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">17</span><span class="p">]:</span> <span class="nd">@wrapper</span>
   <span class="o">....</span><span class="p">:</span> <span class="k">def</span> <span class="nf">sub</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
   <span class="o">....</span><span class="p">:</span>     <span class="k">return</span> <span class="n">Coordinate</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">b</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">b</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
   <span class="o">....</span><span class="p">:</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">18</span><span class="p">]:</span> <span class="n">add</span><span class="p">(</span><span class="n">one</span><span class="p">,</span> <span class="n">three</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">18</span><span class="p">]:</span> <span class="n">Coord</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">}</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">19</span><span class="p">]:</span> <span class="n">one</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">19</span><span class="p">]:</span> <span class="n">Coord</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">}</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">20</span><span class="p">]:</span> <span class="n">sub</span><span class="p">(</span><span class="n">one</span><span class="p">,</span> <span class="n">two</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">20</span><span class="p">]:</span> <span class="n">Coord</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="mi">400</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
</pre></div>
<p>这样，只计算的函数<tt class="docutils literal">add</tt>与<tt class="docutils literal">sub</tt>前面加一个 Decorator
就可以完成坐标的校验。比在函数内实现要优雅一些。</p>
<p>Decorator 还可以为类增加额外的成员，</p>
<div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">21</span><span class="p">]:</span> <span class="k">def</span> <span class="nf">hello</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
   <span class="o">....</span><span class="p">:</span>     <span class="n">cls</span><span class="o">.</span><span class="n">hello</span> <span class="o">=</span> <span class="nb">staticmethod</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="s2">&quot;HELLO&quot;</span><span class="p">)</span>
   <span class="o">....</span><span class="p">:</span>     <span class="k">return</span> <span class="n">cls</span>
   <span class="o">....</span><span class="p">:</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">22</span><span class="p">]:</span> <span class="nd">@hello</span>
   <span class="o">....</span><span class="p">:</span> <span class="k">class</span> <span class="nc">World</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span><span class="k">pass</span>
   <span class="o">....</span><span class="p">:</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">23</span><span class="p">]:</span> <span class="n">World</span><span class="o">.</span><span class="n">hello</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">23</span><span class="p">]:</span> <span class="o">&lt;</span><span class="n">function</span> <span class="n">__main__</span><span class="o">.&lt;</span><span class="k">lambda</span><span class="o">&gt;&gt;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">24</span><span class="p">]:</span> <span class="n">World</span><span class="o">.</span><span class="n">hello</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">24</span><span class="p">]:</span> <span class="s1">&#39;HELLO&#39;</span>
</pre></div>
<div class="section" id="functools-wraps">
<h3>functools.wraps</h3>
<p>我们在使用 Decorator 的过程中，难免会损失一些原本的功能信息。直接拿
stackoverflow 里面的栗子</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">logged</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">with_logging</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">print</span> <span class="n">func</span><span class="o">.</span><span class="n">__name__</span> <span class="o">+</span> <span class="s2">&quot; was called&quot;</span>
        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">with_logging</span>

<span class="nd">@logged</span>
<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot;does some math&quot;&quot;&quot;</span>
   <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span>

<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;does some math&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">logged</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">24</span><span class="p">]:</span> <span class="n">f</span><span class="o">.</span><span class="n">__name__</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">24</span><span class="p">]:</span> <span class="n">with_logging</span>
</pre></div>
<p>而functools.wraps 则可以将原函数对象的指定属性复制给包装函数对象, 默认有
<tt class="docutils literal">__module__</tt>、<tt class="docutils literal">__name__</tt>、<tt class="docutils literal">__doc__</tt>,或者通过参数选择。代码如下：</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">wraps</span>
<span class="k">def</span> <span class="nf">logged</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">with_logging</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">print</span> <span class="n">func</span><span class="o">.</span><span class="n">__name__</span> <span class="o">+</span> <span class="s2">&quot; was called&quot;</span>
        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">with_logging</span>

<span class="nd">@logged</span>
<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot;does some math&quot;&quot;&quot;</span>
   <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span>

<span class="k">print</span> <span class="n">f</span><span class="o">.</span><span class="n">__name__</span>  <span class="c1"># prints &#39;f&#39;</span>
<span class="k">print</span> <span class="n">f</span><span class="o">.</span><span class="n">__doc__</span>   <span class="c1"># prints &#39;does some math&#39;</span>
</pre></div>
</div>
</div>

        </div>
        <div class="post_list">
            <span>By </span>
            <a href="http://www.sunisdown.me/author/sunisdown.html">@SunisDown</a>
            <span> in </span>
            <span class="post_category"><a href="http://www.sunisdown.me/category/articles.html" rel="bookmark" title="Permalink to articles">[ articles ]</a></span>
            <span class="post_date">Mon 08 July 2013</span>
            <div><span>Tags : </span>
                <span><a href="http://www.sunisdown.me/tag/python.html">#python, </a></span>
                <span><a href="http://www.sunisdown.me/tag/decorator.html">#decorator, </a></span>
            </div>

            <div class="entry-social">
                <span class="twitter"><a target="_blank" rel="nofollow" onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=400,width=700');return false;" title="Twitter" href="https://twitter.com/share?url=http://www.sunisdown.me/python-zhuang-shi-qi-zhi-functoolswraps.html&text=Python 装饰器之 functools.wraps&via="><img src="http://www.sunisdown.me/theme/images/icons/twitter-s.png"></a></span>

                <span class="gplus"><a target="_blank" title="Google +" href="https://plus.google.com/share?url=http://www.sunisdown.me/python-zhuang-shi-qi-zhi-functoolswraps.html&hl=fr" rel="nofollow" onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=450,width=650');return false;"><img src="http://www.sunisdown.me/theme/images/icons/google-s.png"></a></span>

                <span class="facebook"><a target="_blank" title="Facebook" rel="nofollow" onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=500,width=700');return false;" href="https://www.facebook.com/sharer.php?u=http://www.sunisdown.me/python-zhuang-shi-qi-zhi-functoolswraps.html&t=Python 装饰器之 functools.wraps"><img src="http://www.sunisdown.me/theme/images/icons/facebook-s.png"></a></span>

                <a  target="_blank" title="Linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=http://www.sunisdown.me/python-zhuang-shi-qi-zhi-functoolswraps.html&title=Python 装饰器之 functools.wraps" rel="nofollow" onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=450,width=650');return false;"><img src="http://www.sunisdown.me/theme/images/icons/linkedin-s.png"></a>

                <span class="mail"><a href="mailto:?subject=Python 装饰器之 functools.wraps&amp;body=Viens découvrir un article à propos de [Python 装饰器之 functools.wraps] sur le site de sunisdown. http://www.sunisdown.me/python-zhuang-shi-qi-zhi-functoolswraps.html" title="Share by Email" target="_blank"><img src="http://www.sunisdown.me/theme/images/icons/mail-s.png"></a></span>
            </div>
        </div>
    </article>
</section>
  </article>

  <!-- Footer -->
  <footer>
    <p>
      Blog powered by <a href="http://getpelican.com/">Pelican</a>, 
      which takes great advantage of <a href="http://python.org">Python</a>.
      Theme <a href="https://github.com/parbhat/pelican-blue">Pelican-Blue</a> by <a href="https://parbhatpuri.com/">@parbhat</a>.
    </p>
  </footer>


</body>
</html>